<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN"
                         "concept.dtd" [<!ENTITY % entities PUBLIC '-//XDOC//ENTITIES//FujitsuUserDoc' 'entities.dtd'>
]>
<!-- Copyright FUJITSU LIMITED 2017 -->
<concept id="concept_E8D43EB4494E41D2AB42D4A89396D1AB"
                xml:lang="en-us">
    <title>Configuration</title>
    <conbody>
        <section>
            <p>The following steps must be performed manually to enable access to the monitoring functionality in OpenStack Horizon:</p>
            <ol compact="no">
                <li>
                    <p>Specify the IP address of your <ph
                            conref="../../shared/product-name.xml#ProductNameTopic/Product_Abbr"
                            /> node in your <codeph>local_settings.py</codeph> file. The file is located in your plugin installation directory <codeph>&lt;monasca_ui_dir>/lib/python2.7/site-packages/monitoring/config</codeph>:</p>
                    <codeblock>GRAFANA_URL = getattr(settings, 'GRAFANA_URL', {'&lt;region>': 'http://&lt;cmm_ip>:3000/', })

ENABLE_KIBANA_BUTTON = getattr(settings, 'ENABLE_KIBANA_BUTTON', True)
KIBANA_POLICY_RULE = getattr(settings, 'KIBANA_POLICY_RULE',
                             'monitoring:kibana_access')
KIBANA_POLICY_SCOPE = getattr(settings, 'KIBANA_POLICY_SCOPE',
                             'monitoring')
KIBANA_HOST = getattr(settings, 'KIBANA_HOST', 
                             'http://&lt;cmm_ip>:5601/')</codeblock>
                    <p>Replace <codeph>&lt;cmm_ip></codeph> by the IP address of the <ph
                            conref="../../shared/product-name.xml#ProductNameTopic/Product_Abbr"
                            /> node for the <codeph>GRAFANA_URL</codeph> and the <codeph>KIBANA_HOST</codeph> parameters, for example, <codeph>http://192.168.10.4</codeph>. Replace <codeph>&lt;region></codeph> by the name of your OpenStack region, for example <codeph>RegionOne</codeph>.</p>
                </li>
                <li>
                    <p>To integrate the Monitoring Service with the OpenStack Horizon service, create links pointing to the Horizon Plugin.</p>
                    <p>Example with <codeph>/opt/monasca-ui/</codeph> as plugin installation directory:</p>
                    <codeblock>ln -s /opt/monasca-ui/lib/python2.7/site-packages/
  monitoring/enabled/_50_admin_add_monitoring_panel.py \
/usr/share/openstack-dashboard/openstack_dashboard/
  local/enabled/_50_admin_add_monitoring_panel.py

ln -s /opt/monasca-ui/lib/python2.7/site-packages/
  monitoring/conf/monitoring_policy.json \
/etc/openstack-dashboard/monitoring_policy.json</codeblock>
                </li>
                <li>
                    <p>Append the virtual env libraries of the Horizon Plugin to the system path of the OpenStack Horizon service. For this purpose, two files must be edited. </p>
                    <p>Append the path where the plugin is installed to the <codeph>django.wsgi</codeph> file. The WSGI script of your OpenStack platform is located in the <codeph>/usr/share/openstack-dashboard/openstack_dashboard/wsgi</codeph> directory.</p>
                    <p>Example of <codeph>django.wsgi</codeph> file with <codeph>/opt/monasca-ui/</codeph> as plugin installation directory:</p>
                    <codeblock>import logging
import os
import sys
sys.path.append("/opt/monasca-ui/lib/python2.7/site-packages")
from django.core.wsgi import get_wsgi_application
from django.conf import settings

# Add this file path to sys.path in order to import settings
sys.path.insert(0, os.path.join(os.path.dirname(os.path.realpath(__file__)), '../..'))
os.environ['DJANGO_SETTINGS_MODULE'] = 'openstack_dashboard.settings'
sys.stdout = sys.stderr

DEBUG = False

application = get_wsgi_application()</codeblock>
                    <p>Append the path where the plugin is installed to the <codeph>manage.py</codeph> file. The <codeph>manage.py</codeph> file is located in the <codeph>/usr/share/openstack-dashboard</codeph> directory.</p>
                    <p>Example of  <codeph>manage.py</codeph> file with <codeph>/opt/monasca-ui/</codeph> as plugin installation directory:</p>
                    <codeblock>import os
import sys

from django.core.management import execute_from_command_line  # noqa

if __name__ == "__main__":
    os.environ.setdefault("DJANGO_SETTINGS_MODULE",
                          "openstack_dashboard.settings")
    sys.path.append('/opt/monasca-ui/lib/python2.7/site-packages')
    execute_from_command_line(sys.argv)</codeblock>
                </li>
                <li>
                    <p>If it is required to provide the Japanese version of the Horizon plugin, make the following preparation. </p>
                    <p>Example with <codeph>/opt/monasca-ui/</codeph> as plugin installation directory:</p>
                    <codeblock>cd /opt/monasca-ui/lib/python2.7/site-packages/monitoring/
/opt/monasca-ui/lib/python2.7/site-packages/django/bin/django-admin.py compilemessages -l ja</codeblock>
                </li>
                <li>
                    <p>Restart the server on which the OpenStack Horizon service is running.</p>
                    <p>Example: </p>
                    <codeblock>systemctl restart httpd</codeblock>
                </li>
            </ol>
        </section>
    </conbody>
</concept>
