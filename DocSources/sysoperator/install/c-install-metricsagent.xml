<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN"
                         "concept.dtd" [<!ENTITY % entities PUBLIC '-//XDOC//ENTITIES//FujitsuUserDoc' 'entities.dtd'>
]>
<!-- Copyright FUJITSU LIMITED 2017 -->
<concept id="concept_E8D43EB4494E41D2AB42D4A89396D1AB"
                xml:lang="en-us">
    <title>Installing a Metrics Agent</title>
    <conbody>
        <section>
            <p>For monitoring the OpenStack services in your environment, you need to install a Metrics Agent on the server on which the OpenStack services are running. The agent installer performs the following tasks:</p>
            <ul>
                <li>
                    <p>It automatically configures the agent to retrieve metrics data from the server and send the data to the Monitoring Service for further processing.</p>
                </li>
                <li>
                    <p>It automatically activates system metrics for monitoring your OpenStack services and the server on which they are running. The metrics include system checks, for example, on CPU usage, disk space, or the average system load. No manual configuration is required for these checks.</p>
                </li>
                <li>
                    <p>As enhancement to the system metrics, the installer auto-detects applications and OpenStack processes that are running on the server. The corresponding metrics are automatically configured. No manual configuration is required.</p>
                </li>
            </ul>
            <p>The agent installer creates all configuration files required for monitoring. They include the following:</p>
            <ul>
                <li>
                    <p><codeph>agent.yaml</codeph> located in the <codeph>/etc/monasca/agent</codeph> directory.</p>
                    <p>It defines the agent configuration. </p>
                </li>
                <li>
                    <p><codeph>*.yaml</codeph> files located in the <codeph>/etc/monasca/agent/conf.d</codeph> directory. </p>
                    <p>They provide the metrics the agent uses for monitoring. A <codeph>*.yaml</codeph> file is provided for each set of system metrics and for the additional metrics used to monitor the specific applications and OpenStack processes that are auto-detected. The <codeph>*.yaml</codeph> files store the configuration information that is auto-detected during the installation process. </p>
                    <p>For details on the system metrics and the additional metrics, refer to <xref
                            href="../appendix/r-metricsadditional.xml"/>.</p>
                </li>
                <li>
                    <p><codeph>*.yaml</codeph> files located in the <codeph>/opt/monasca-agent/share/monasca/agent/conf.d</codeph> directory. </p>
                    <p>They provide metrics that you can activate as enhancement to the metrics that are automatically provided with the agent installation. These files provide template configurations that you can adapt to your environment.</p>
                </li>
            </ul>
            <p>The installation of an agent includes its initial configuration. This ensures that comprehensive metrics data for monitoring your OpenStack services and servers is retrieved. </p>
            <p>Options are also provided for reconfiguring an agent following a successful installation. You can update the <codeph>agent.yaml</codeph> file, and you can activate metrics in addition to the ones that are provided automatically with the installation. </p>
        </section>
        <section>
            <title>Installation</title>
            <p>To install a Metrics Agent, proceed as follows:</p>
            <ol compact="no">
                <li>
                    <p>Log in to the machine on which to install the Metrics Agent.</p>
                </li>
                <li>
                    <p>Run the agent installer, and provide the required OpenStack Keystone credentials.</p>
                    <p>Example:</p>
                    <codeblock>./monasca-agent-&lt;version_number>.run \
--target /opt/monasca/monasca-agent -- \
--username myuser \                   
--password mypassword \                   
--project_name monitoring \                
--keystone_url http://192.168.1.5:35357/v3 \  
--monasca_statsd_port 8126        </codeblock>
                    <p>The minimum set of parameters to be configured for running the installer includes:</p>
                    <ul>
                        <li>
                            <p><codeph>--target</codeph>. Optional. The directory  in which the agent is installed. If <codeph>--target</codeph> is not specified, the agent is installed in the current working directory. </p>
                        </li>
                        <li>
                            <p><codeph>--username</codeph>. Mandatory. The user to be used for authenticating the agent against OpenStack Keystone.</p>
                            <p>The user specified here must have the <codeph>cmm-agent</codeph> role in OpenStack and be assigned to the OpenStack project that is to be monitored by the agent. The project is specified in <codeph>project_name</codeph>.</p>
                            <p>It is recommended that this user is used only for configuration purposes and not for actually monitoring services and servers.</p>
                        </li>
                        <li>
                            <p><codeph>--password</codeph>. Mandatory. The password of the user specified in <codeph>--username</codeph>.</p>
                        </li>
                        <li>
                            <p><codeph>--project_name</codeph>. Optional. The name of the OpenStack project for which metrics data is to be retrieved by the agent. If <codeph>--project_name</codeph> is not specified, the data is retrieved from the default project assigned to the user specified in <codeph>--username</codeph>.</p>
                        </li>
                        <li>
                            <p><codeph>--keystone_url</codeph>. Mandatory parameter specifying the URL used to access the server where the OpenStack Keystone service is installed. It must be a V3 endpoint.</p>
                        </li>
                        <li>
                            <p><codeph>--monasca_statsd_port</codeph>. Optional. The port number for the StatsD daemon. The default port number must be changed from <codeph>8125</codeph> to <codeph>8126</codeph>. Port <codeph>8125</codeph> is used by Gnocchi in Red Hat Enterprise Linux OpenStack Platform 10 ##OSP 10 all in one##. </p>
                        </li>
                    </ul>
                    <p>Help is available on the configuration settings that can be defined for a metrics agent. For a description of the configuration settings, run the following command: </p>
                    <codeblock>./monasca-agent-&lt;version_number>.run --help</codeblock>
                </li>
            </ol>
            <p>For additional details, you can also refer to the <xref format="html"
                    href="https://github.com/openstack/monasca-agent/blob/master/docs/Agent.md#explanation-of-primary-monasca-setup-command-line-parameters"
                    scope="external"><u><i>Monasca documentation</i></u></xref>.</p>
            <p>The installer creates a <codeph>monasca-agent.service</codeph> file in the <codeph>/etc/systemd/system</codeph> directory, and automatically runs the service file to start the agent. </p>
            <p>The agent is provided as a LINUX service. A startup script is created that automatically starts the agent each time the machine is booted. </p>
            <p>In case the installation fails, check your configuration settings and passwords. To collect debugging information, you can retry the installation in verbose mode:</p>
            <codeblock>./monasca-agent-&lt;version_number>.run --verbose</codeblock>
        </section>
        <section>
            <title>Updating the Configuration File</title>
            <p>To edit the <codeph>agent.yaml</codeph> configuration file, proceed as follows:</p>
            <ol>
                <li>
                    <p>Log in to the server where the agent is installed.</p>
                </li>
                <li>
                    <p>To stop the agent, execute the following command:</p>
                    <codeblock>sudo systemctl stop openstack-monasca-agent</codeblock>
                </li>
                <li>
                    <p>Open the file with your favorite editor.</p>
                    <p>Example:</p>
                    <codeblock>sudo vim /etc/monasca/agent/agent.yaml</codeblock>
                </li>
                <li>
                    <p>Adapt the configuration settings as required. </p>
                    <!-- p>For a list of the parameters that are supported by <ph
                            conref="../../shared/product-name.xml#ProductNameTopic/Product_Abbr"/>, refer to <xref
                            href="../appendix/r-confsettings-metrics.xml"/>.</p -->
                </li>
                <li>
                    <p>To start the agent again, execute the following command:</p>
                    <codeblock>sudo systemctl start openstack-monasca-agent	</codeblock>
                </li>
            </ol>
            <p>The agent is instantly available with the updated configuration settings.</p>
        </section>
        <section>
            <title>Activating Additional Metrics</title>
            <p>The installer automatically activates standard metrics for monitoring your services and servers. They include system checks, for example, on CPU usage, disk space, or the average system load. No manual configuration is required for these system checks. The installer automatically configures them to retrieve monitoring data from the server where your agent is installed. For details on these metrics, refer to <xref
                    href="../appendix/r-metricsstandard.xml"/>.</p>
            <p>As enhancement to the standard metrics, <ph
                    conref="../../shared/product-name.xml#ProductNameTopic/Product_Abbr"
                    /> allows you to activate additional metrics. For a list of the metrics that are supported by <ph
                    conref="../../shared/product-name.xml#ProductNameTopic/Product_Abbr"/>, refer to <xref
                    href="../appendix/r-metricsadditional.xml"
                    />. For details on the complete set of metrics provided by the Monasca project, refer to the <xref
                    format="html" href="https://github.com/openstack/monasca-agent/blob/stable/ocata/docs/Plugins.md"
                    scope="external"><u><i>Monasca documentation</i></u></xref>.</p>
            <p>The agent ships with metrics templates that you can adapt to your environment and use for monitoring your services and servers.</p>
            <p>To activate additional metrics, proceed as follows: </p>
            <ol>
                <li>
                    <p>Log in to the server where the agent is installed.</p>
                </li>
                <li>
                    <p>To stop the agent, execute the following command:</p>
                    <codeblock>sudo systemctl stop openstack-monasca-agent</codeblock>
                </li>
                <li>
                    <p>Copy the required template file.</p>
                    <p>Example:</p>
                    <codeblock>sudo cp -p \
 /opt/monasca-agent/share/monasca/agent/conf.d/rabbitmq.yaml.example \
 /etc/monasca/agent/conf.d/rabbitmq.yaml</codeblock>
                </li>
                <li>
                    <p>Open the template file with your favorite editor.</p>
                    <p>Example:</p>
                    <codeblock>sudo vim /etc/monasca/agent/conf.d/rabbitmq.yaml</codeblock>
                </li>
                <li>
                    <p>Adapt the configuration to your environment. For configuration examples, refer to <xref
                            href="../appendix/r-metricsadditional.xml"/>.</p>
                </li>
                <li>
                    <p>To start the agent again, execute the following command:</p>
                    <codeblock>sudo systemctl start openstack-monasca-agent</codeblock>
                </li>
            </ol>
            <p>The activated metrics can instantly be used by the agent for retrieving monitoring data.</p>
            <note othertype="note">
                <p>The installer auto-detects applications and processes that are running on your system. It saves the detected settings to the corresponding configuration files, and automatically provides these files in the the <codeph>/etc/monasca/agent/conf.d/</codeph> directory (e.g. <codeph>host_alive.yaml</codeph>, <codeph>http_check.yaml</codeph>, or <codeph>process.yaml</codeph>). </p>
            </note>
        </section>
    </conbody>
</concept>
