<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN"
                         "concept.dtd" [<!ENTITY % entities PUBLIC '-//XDOC//ENTITIES//FujitsuUserDoc' 'entities.dtd'>
]>
<!-- Copyright FUJITSU LIMITED 2017 -->
<concept id="concept_E8D43EB4494E41D2AB42D4A89396D1AB"
                            xml:lang="en-us">
    <title>Installation</title>
    <conbody>
        <section>
            <p>To install a Metrics Agent, proceed as follows:</p>
            <ol
                    compact="no">
                <li>
                    <p>Log in to the OpenStack node on which to install the Metrics Agent.</p>
                </li>
                <li>
                    <p>Prepare an installation directory. </p>
                </li>
                <li>
                    <p>Extract the <codeph>CMM_client_2.0.0.zip</codeph> archive file from the <ph
                            conref="../../shared/product-name.xml#ProductNameTopic/Product_Abbr"
                        /> installation package to the installation directory. The archive provides the following files:</p>
                    <ul>
                        <li><codeph>log-agent-2.4.1_0.5.3.run</codeph></li>
                        <li><codeph>monasca-agent-2.2.0.run</codeph></li>
                        <li><codeph>monasca-ui-1.5.1.run</codeph></li>
                    </ul>
                </li>
                <li>
                    <p>Change the access permission of the <codeph>monasca-agent-2.2.0.run</codeph> file to Execute.</p>
                </li>
                <li>
                    <p>Make sure that your <codeph>/root/.my.cnf</codeph> file does not define any passwords in single quotes.</p>
                </li>
                <li>
                    <p>Run the agent installer, and provide the required OpenStack Keystone credentials. </p>
                    <codeblock>./monasca-agent-2.2.0.run \
--target /opt/monasca-agent -- \
--username &lt;user_name> \           
--password &lt;password> \                   
--project_name &lt;project_name> \  
--user_domain_name default \ 
--project_domain_name default \ 
--service_type monitoring \
--keystone_url &lt;openstack_ip>:35357/v3 \  
--monasca_statsd_port &lt;port_no>     
--skip_detection_plugins OVS Libvirt </codeblock>
                    <p>The minimum set of parameters to be configured for running the installer includes:</p>
                    <ul>
                        <li>
                            <p><codeph>--target</codeph>. Optional. The directory  in which the agent is installed. If <codeph>--target</codeph> is not specified, the agent is installed in the current working directory. </p>
                        </li>
                        <li>
                            <p><codeph>--username</codeph>. Mandatory. The user to be used for authenticating the agent against OpenStack Keystone, for example <codeph>monasca-agent</codeph>.</p>
                            <p>The user specified here must have the <codeph>monasca-agent</codeph> role in OpenStack and be assigned to the OpenStack project that is to be monitored by the agent. The project is specified in <codeph>project_name</codeph>, for example, <codeph>monasca</codeph>.</p>
                            <p>It is recommended that this user is used only for configuration purposes and not for actually monitoring services and servers.</p>
                        </li>
                        <li>
                            <p><codeph>--password</codeph>. Mandatory. The password of the user specified in <codeph>--username</codeph>.</p>
                        </li>
                        <li>
                            <p><codeph>--project_name</codeph>. Optional. The name of the OpenStack project for which metrics data is to be retrieved by the agent. If <codeph>--project_name</codeph> is not specified, the data is retrieved from the default project assigned to the user specified in <codeph>--username</codeph>.</p>
                        </li>
                        <li>
                            <p>##<codeph> --user_domain_name</codeph>. Optional. The user domain name to be used for user name scoping. <i>If not specified, what does <codeph>default</codeph> imply?</i></p>
                        </li>
                        <li>
                            <p>## --<codeph>project_domain_name</codeph>. Optional. The project domain name used for authenticating the agent against OpenStack Keystone. <i>If not specified, what does <codeph>default</codeph> imply?</i></p>
                        </li>
                        <li>
                            <p>## <codeph>--service_type</codeph>. Example: <codeph>monitoring</codeph></p>
                        </li>
                        <li>
                            <p><codeph>--keystone_url</codeph>. Mandatory parameter specifying the URL used to access the server where the OpenStack Keystone service is installed. It must be a V3 endpoint. Example: <codeph>http://192.168.1.5:35357/v3</codeph></p>
                        </li>
                        <li>
                            <p><codeph>--monasca_statsd_port</codeph>. Optional. The port number for the StatsD daemon. Check whether the default port number must be changed from <codeph>8125</codeph> to <codeph>8126</codeph>. Port <codeph>8125</codeph> is used by Gnocchi in Red Hat Enterprise Linux OpenStack Platform 10.</p>
                        </li>
                        <li>
                            <p>## <codeph>--skip_detection_plugins</codeph>. <i>Optional or mandatory?</i> Example: <codeph>OVS Libvirt</codeph>.</p>
                        </li>
                    </ul>
                </li>
            </ol>
            <p>For additional details, you can refer to the <xref format="html"
                    href="https://github.com/openstack/monasca-agent/blob/stable/pike/docs/Agent.md#explanation-of-primary-monasca-setup-command-line-parameters"
                    scope="external"
                ><u><i>Monasca documentation</i></u></xref>. Help is also available on the configuration settings. For a description of the settings, run the following command: </p>
            <codeblock>./monasca-agent-&lt;version_number&gt;.run --help</codeblock>
            <p>In case the installation fails, check your configuration settings and passwords. To collect debugging information, you can retry the installation in verbose mode:</p>
            <codeblock>./monasca-agent-&lt;version_number&gt;.run --verbose</codeblock>
            <p>
                <note othertype="note">
                    <p>When running the installer, you can ignore error messages related to components that do not exist in your OpenStack environment, e.g. <codeph>ERROR: Kibana process has not been found. Plugin for Kibana will not be configured.</codeph></p>
                    <p>The agent tries to auto-detect a specific set of processes and outputs an error message if a process is not found. Irrespective of these messages, the agent is successfully installed.</p>
                </note>
            </p>
            <p>The installer creates a <codeph>monasca-agent.service</codeph> file in the <codeph>/etc/systemd/system</codeph> directory, and automatically runs the service file to start the agent after a successful installation.</p>
            <p>The agent is provided as a LINUX service. A startup script is created that automatically starts the agent each time the machine is booted. </p>
            <p>The agent is installed in a virtualenv environment. By default, the virtualenv enviroment is located in the <codeph>/opt/monasca-agent</codeph> directory.</p>
        </section>
    </conbody>
</concept>
